= form_for @expense, multipart: true do |f|
  .row
    .col.s12
      %span.bold (*) Required field

  - if @expense.errors.any?
    #errors.red-text.center.bold An error occured

  .row.top-space
    .input-field.col.s12.m4
      = f.select :source, options_for_select(Expense.sources.keys,@expense.source),{}, class: 'source-select'
      = f.label :source, 'Proof of payment (*)'
      %small.red-text#source_error= @expense.errors.full_messages_for(:source).to_sentence
    .input-field.col.s12.m4.fields-with-invoice{class: "#{'hidden' if @expense.other? }"}
      = f.text_field :document_number, data: { length: '50' }
      = f.label :document_number, 'Document number (*)', class: 'active'
      %small.red-text#document_number_error= @expense.errors.full_messages_for(:document_number).to_sentence
    .input-field.col.s12.m4.autocomplete-wrapper
      = text_field_tag :category_name,param_or_resource(params[:category_name],:category,@expense,:name), class: 'autocomplete-categories-expenses autocomplete', autocomplete: 'off'
      = label_tag :category_name, 'Category', class: 'active'

      #categories_expense.hidden
        - @categories.each do |category|
          %p{'data-id': category.id}= category.name

  .row
    .col.s12
      %span.bold.border-collection Provider information

  .row
    .input-field.col.s12.m4
      = f.select :provider_id, options_from_collection_for_select(@providers,:id,:name,@expense.provider_id), {prompt: 'Choose an option'}, class: 'provider-select'
      = f.label :provider_id, 'Provider (*)'
      %small.red-text#provider_error= @expense.errors.full_messages_for(:provider).to_sentence
      = link_to 'More', provider_information_expenses_path, remote: true, class: 'hidden', id: 'provider_information_link'
    .input-field.col.s12.m3
      = f.select :country_id, options_from_collection_for_select(@countries,:id,:name,@expense.country_id),{ prompt: 'Choose an option' }, class: 'country-select'
      = f.label :country_id, 'Country (*)'
      %small.red-text#country_error= @expense.errors.full_messages_for(:country).to_sentence
  .row#provider_information.inline{class: "#{'hidden' unless @expense.provider_id.present?}" }
    .input-field.col.s12.m3
      = text_field_tag :ruc, @expense.provider.try(:ruc), class: 'ruc-field', disabled: true
      = label_tag :ruc, 'Provider RUC'
    .input-field.col.s12.m3
      = text_field_tag :address, @expense.provider.try(:address), class: 'address-field', disabled: true
      = label_tag :address, 'Provider address'
    .input-field.col.s12.m3
      = text_field_tag :phone, @expense.provider.try(:phone), class: 'phone-field', disabled: true
      = label_tag :phone, 'Provider phone'

  .fields-with-other{class: "#{'hidden' unless @expense.other?}"}
    .row
      .col.s12
        %span.bold.border-collection Team information
    .row
      .input-field.col.s12.m3
        = f.select :team_id, options_from_collection_for_select(@teams,:id,:name,@expense.team_id), { prompt: 'Choose an option' }, class: 'team-select'
        = f.label :team_id, 'Team (*)'
        %small.red-text#team_error= @expense.errors.full_messages_for(:team).to_sentence
        = link_to 'More', collaborators_information_expenses_path, remote: true, class: 'hidden', id: 'collaborators_information_link'
      #collaboration_information{class: "#{'hidden' unless @expense.team_id.present?}"}
        .input-field.col.s12.m3
          = render partial: 'collaborators_information', locals: { f: f }

      .input-field.col.s12.m3
        = f.text_field :issue_at, class: 'datepicker', value: "#{@expense.issue_at.try(:strftime,'%Y-%m-%d')}"
        = f.label :issue_at, 'Issue date (*)', class: 'active'
        %small.red-text#issue_at= @expense.errors.full_messages_for(:issue_at).to_sentence
  .row
    .col.s12
      %span.bold.border-collection General information

  .row
    .input-field.col.s12.m3
      = f.text_field :description, data: { length: '200'}
      = f.label :description, 'Description (*)', class: 'active'
      %small.red-text#description_error= @expense.errors.full_messages_for(:description).to_sentence
    .input-field.col.s12.m3
      = f.select :currency_id, options_from_collection_for_select(@currencies,:id,:name,@expense.currency_id)
      = f.label :currency_id, 'Currency (*)'
      %small.red-text#currency_error= @expense.errors.full_messages_for(:currency).to_sentence
    .input-field.col.s12.m3
      = f.number_field :amount, step: 'any', class: 'amout-field'
      = f.label :amount, 'Amount included IGV(*)', class: 'active'
      %small.red-text#amount_error= @expense.errors.full_messages_for(:amount).to_sentence
    .input-field.col.s12.m3
      = f.select :state, class_enum_for_select("Expense","state"), {}, class: 'state-select-income'
      = label_tag :state, 'State(*)'

  .row
    .input-field.col.s12.m4
      = f.text_field :registered_at, class: 'datepicker', value: @expense.registered_at.try(:strftime,"%Y-%m-%d")
      = f.label :registered_at, 'Registered at (*)', class: 'active'
      %small.red-text#registered_at_error= @expense.errors.full_messages_for(:registered_at).to_sentence
    .input-field.col.12.m3.transaction-at-wrapper-income{class: "#{'hidden' unless @expense.paid? }"}
      = f.text_field :transaction_at, class: 'datepicker', value: @expense.transaction_at.try(:strftime,"%Y-%m-%d")
      = f.label :transaction_at, 'Transaction at (*)', class: 'active'
      %small.red-text#transaction_at_error= @expense.errors.full_messages_for(:transaction_at).to_sentence
    .input-field.col.s12.m3.fields-with-invoice{class: "#{'hidden' if @expense.other? }"}
      = f.text_field :planned_payment_at, class: 'datepicker', value: @expense.planned_payment_at.try(:strftime,"%Y-%m-%d")
      = f.label :planned_payment_at, 'Planned payment at (*)', class: 'active'
      %small.red-text#planned_payment_at_error= @expense.errors.full_messages_for(:planned_payment_at).to_sentence
  .row
    .col.s12.m6
      .file-field.input-field
        .btn.deep-purple.accent-4
          %span Document
          = f.file_field :transaction_document
        .file-path-wrapper
          %input{type: 'text', class: 'file-path validate', value: @expense.transaction_document.original_filename}
      %small.red-text#invoice_copy_error= @expense.errors.full_messages_for(:transaction_document).to_sentence


  .row.fields-with-invoice{class: "#{'hidden' if @expense.other? }"}
    .col.s12.m2
      %label With fee
    .col.s12.m10
      .switch.top-space
        %label
          No
          = f.check_box :with_fee, class: 'with-fee-toggle'
          %span.lever
          Yes

  %div{class: "row fees-container fields-with-invoice #{'hidden' if !@expense.with_fee }" }
    .col.s12
      = f.label :fees, 'Fees'
      %small.red-text= @expense.errors.full_messages_for(:fees).to_sentence
    .col.s12.top-space
      #fees
        = f.fields_for :fees do |fee_form|
          = render 'fee_fields', f: fee_form
        %p= link_to_add_association 'Add a fee', f, :fees

  .row.fields-with-invoice{class: "#{'hidden' if @expense.other? }"}
    .input-field.col.s12.m4
      = f.select :payment_type, options_for_select(Expense.payment_types.keys,:payment_type), {}, class: 'payment-type-select'
      = f.label :payment_type

  %div{class: "fields-with-invoice #{'hidden' if @expense.other? }"}
    %div{class: "row transference-container #{'hidden' unless @expense.transference?}"}
      .input-field.col.s12.m3
        = f.select :bank_id, options_from_collection_for_select(@banks,:id,:name,@expense.bank_id), { prompt: 'Choose an option'}
        = f.label :bank_id
      .input-field.col.s12.m3
        = f.text_field :account_number
        = f.label :account_number, class: 'active'
      .input-field.col.s12.m3
        = f.text_field :cci
        = f.label :cci, 'CCI', class: 'active'
      .input-field.col.s12.m3
        = f.email_field :contact_email
        = f.label :contact_email, class: 'active'

  %div{class: "fields-with-invoice #{'hidden' if @expense.other? }"}
    %div{class: "row upon-delivery-container fields-with-invoice #{'hidden' unless @expense.upon_delivery?}"}
      .input-field.col.s12.m4
        = f.text_field :place_of_delivery
        = f.label :place_of_delivery, class: 'active'
      .input-field.col.s12.m4
        = f.text_field :delivery_at, class: 'datepicker'
        = f.label :delivery_at, class: 'active'

